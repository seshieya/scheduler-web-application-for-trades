<?php

////echo '<pre>';
////var_dump($_POST);
//
//
//$job = [];
//$row = [];
//$rowNum = 1;
//
//
////	$job = [];
////	$job['jobNumber'] = $_POST['sc-job-number'];
////	$job['jobNumber'] = $_POST['sc-job-address'];
////	$job['jobNumber'] = $_POST['sc-coordinator'];
////	$job['jobNumber'] = $_POST['sc-coord-phone'];
////	$job['jobNumber'] = $_POST['sc-job-access'];
////	$job['jobNumber'] = $_POST['sc-startdate'];
////	$job['jobNumber'] = $_POST['sc-row1-unitnum'];
////	$job['jobNumber'] = $_POST['sc-row1-type'];
////	$job['jobNumber'] = $_POST['sc-row1-trade'];
////	$job['jobNumber'] = $_POST['sc-row1-trade-email'];
////	$job['jobNumber'] = $_POST['sc-row1-days'];
////	$job['jobNumber'] = $_POST['sc-row1-comments'];
//
//foreach ($_POST as $key => $value) {
//    if(strpos($key, 'sc-row' . $rowNum) !== false) {
//        $row[$rowNum][$key] = $value;
//
//        // if(count($row[$rowNum]) === 6) {
//        //     $rowNum++;
//        // }
//    }
//    else if(strpos($key, 'sc-row' . ($rowNum + 1)) !== false) {
//        $row[$rowNum+1][$key] = $value;
//        $rowNum++;
//    }
//    else {
//        $job[$key] = $value;
//    }
//}

//var_dump($job);
echo '<pre>';
//var_dump($this->post);

var_dump($this->job);
var_dump($this->row);


$startdateInSeconds = strtotime($_POST['sc-startdate']);
$startdate = 0;

//startdate in seconds
echo $startdateInSeconds . '<br>';


echo date('w', $startdateInSeconds) . '<br>';



$dayIn = 0;
$dayOut = 0;
$daysNeeded = 0;

$dayInArray = [];
$dayOutArray = [];

$rowDate['dayIn'] = [];
$rowDate['dayOut'] = [];

$dayInSeconds = 0;
$dayOutSeconds = 0;

//$dayInInt = 0;
//$dayOutInt = 0;

/*
foreach($_POST as $key => $value) {
    if(preg_match('/^sc-row1-days/', $key)) {
        $daysNeededInt = $value;
        //$dayInInt = 0;
        //$dayOutInt = $dayInInt + ($daysNeededInt - 1);

        $dayInSeconds = $startdateInSeconds;
        $dayInString = date('D M j', $dayInSeconds);
        $dayOutSeconds = (($daysNeededInt - 1) * $secondsPerDay) + $dayInSeconds;
        $dayOutString = date('D M j', $dayOutSeconds);

        //$rowDate['dayIn'][] =

        echo 'row 1:' . $dayInString . '<br>';
        echo $dayOutString . '<br>';

    }

    if(preg_match('/^sc-row([0-9]|[0-9]{2})-days$/', $key)) {
        $daysNeededInt = $value;
        $dayInInt = $dayOutInt + 1;
        $dayOutInt = $dayInInt + ($daysNeededInt - 1);


        $dayInSeconds = $dayOutSeconds + $secondsPerDay;
        $dayOutSeconds = (($daysNeeded - 1 )* $secondsPerDay) + $dayInSeconds;
    }
}
*/

$rowNum = 1;

//CODE TO CALCULATE DAY IN AND DAY OUT IN INTEGERS and push to an array
foreach($_POST as $key => $value) {
    if(preg_match('/^sc-row1-days/', $key)) {
        $daysNeeded = $value;
        $dayIn = $startdate;
        $dayOut = $dayIn + ($daysNeeded - 1);

        echo 'row ' . $rowNum . ' day in: ' . $dayIn . '<br>';
        echo 'row 1 day out: ' . $dayOut . '<br>';

//        $dayInString = convertToDateString(calculateSeconds($dayIn));
//        echo 'row ' . $rowNum . ' day in: ' . $dayInString . '<br>';

        $dayInArray[$rowNum] = $dayIn;
        $dayOutArray[$rowNum] = $dayOut;


        $rowNum++;
    }
    else if(preg_match('/^sc-row([0-9]|[0-9]{2})-days$/', $key)) {
        $daysNeeded = $value;
        $dayIn = $dayOut + 1;
        $dayOut = $dayIn + ($daysNeeded - 1);

        echo 'row ' . $rowNum . ' day in: ' . $dayIn . '<br>';
        echo 'row ' . $rowNum . ' day out: ' . $dayOut . '<br>';

        $dayInArray[$rowNum] = $dayIn;
        $dayOutArray[$rowNum] = $dayOut;

        $rowNum++;

    }
}





$rowDate['dayIn'] = autoGenerateDates($dayInArray);
$rowDate['dayOut'] = autoGenerateDates($dayOutArray);

var_dump($rowDate);


function calculateSeconds($data) {
    // days in seconds = 60 seconds * 60 minutes * 24 hours = 86400 seconds
    $secondsPerDay = 86400;
    $secondsData = $secondsPerDay * $data;
    return $secondsData;
}

function convertToDateString($data) {
    return date('D M j', $data);
}

function autoGenerateDates($data) {

    $startdateInSeconds = strtotime($_POST['sc-startdate']);

    foreach($data as $key => &$value) {
        $seconds = calculateSeconds($value) + $startdateInSeconds;

        $dateString = convertToDateString($seconds);
        $data[$key] = $dateString;


//        var_dump($seconds);
//        var_dump($dateString);

    }

    return $data;


}








//var_dump($rowDate);



//CODE TO CALCULATE


//$row1Seconds = (($_POST['sc-row1-days'] - 1) * $secondsPerDay) + $startdateInSeconds;
//echo date('w', $row1days);




//$_POST is an array! so I need to somehow get the row1 indexes into it's own array, because that is the dynamic part of the code.... I don't know how many rows the user will make in a schedule.


/* array(13) {
   ['sc-job-number']=>
   string(1) '1'
   ['sc-job-address']=>
   string(4) '3054'
   ['sc-coordinator']=>
   string(4) 'asaf'
   ['sc-coord-phone']=>
   string(12) '250-222-5555'
   ['sc-coord-email']=>
   string(8) 'asdf@adf'
   ['sc-job-access']=>
   string(4) 'asdf'
   ['sc-startdate']=>
   string(10) '06/06/2017'
   ['sc-row1-unitnum']=>
   string(0) '
   ['sc-row1-type']=>
   string(4) 'asdf'
   ['sc-row1-trade']=>
   string(4) 'asdf'
   ['sc-row1-trade-email']=>
   string(13) 'asdf@adsfasdf'
   ['sc-row1-days']=>
   string(1) '3'
   ['sc-row1-comments']=>
   string(4) 'asdf'
 }*/



?>



    <h1>Schedule Maker</h1>

    <table id="sc-table-job">
        <tr>
            <th>Job Number</th>
            <th>Address</th>
            <th>Access</th>
        </tr>
        <tr>
            <td><?php echo $this->job['sc-job-number']; ?></td>
            <td><?php echo $this->job['sc-job-address']; ?></td>
            <td><?php echo $this->job['sc-job-access']; ?></td>
        </tr>
    </table>

    <table id="sc-table-row">
        <tr>
            <td>Type of Work</td>
            <td>Trade</td>
            <td>Date In</td>
            <td>Date Out</td>
            <td>Comments</td>
        </tr>
        <?php

        for($i=1; $i<=count($row); $i++) {
            echo   "<tr>
                  <td>" . $this->row[$i]['sc-row'.$i.'-type'] . "</td>
                  <td>" . $this->row[$i]['sc-row'.$i.'-trade'] . "</td>
                  <td>" . $rowDate['dayIn'][$i] . "</td>
                  <td>" . $rowDate['dayOut'][$i] . "</td>
                  <td>" . $this->row[$i]['sc-row'.$i.'-comments'] . "</td>
                </tr>";
        }



        ?>
    </table>



